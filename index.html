<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>Croft Common</title>
    <meta name="description" content="Hospitality For Good - Croft Common Bristol">
    <meta name="author" content="Croft Common" />
    <link rel="canonical" href="https://www.croftcommontest.com/" />
    
    <!-- Favicon and App Icons -->
    <link rel="icon" href="/brand/logo.png" type="image/png">
    <link rel="apple-touch-icon" sizes="180x180" href="/brand/logo.png">
    <link rel="apple-touch-icon" sizes="167x167" href="/brand/logo.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/brand/logo.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/brand/logo.png">
    <meta name="msapplication-TileImage" content="/brand/logo.png">
    
    <!-- iOS Web App Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Croft Common">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">

    <!-- Preload critical images for intro transition -->
    <link rel="preload" as="image" href="/brand/logo.png" fetchpriority="high">
    <link rel="preload" as="image" href="/lovable-uploads/d1fb9178-8f7e-47fb-a8ac-71350264d76f.png">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600;700&family=Work+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">

    <meta property="og:title" content="Croft Common - Pure Hospitality" />
    <meta property="og:description" content="Pure Hospitality - Croft Common Bristol" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="/brand/logo.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Croft Common - Pure Hospitality" />
    <meta name="twitter:description" content="Pure Hospitality - Croft Common Bristol" />
    <meta name="twitter:image" content="/brand/logo.png" />
    <!-- Bootstrap canonicalisation and token routing BEFORE React loads -->
    <script>
      (function () {
        try {
          var w = window;
          var loc = w.location;
          var hasCap = !!w.Capacitor;
          var isNative = false;
          try { isNative = hasCap && typeof w.Capacitor.isNativePlatform === 'function' && w.Capacitor.isNativePlatform(); } catch (e) { isNative = false; }
          var host = loc.hostname;
          var search = loc.search || '';
          var hash = loc.hash || '';
           var hasRecoveryTokens = /access_token=|refresh_token=|code=|type=recovery|token_hash=/.test(search + hash);
 
           if (!isNative) {
             var onApex = host === 'croftcommontest.com';
             var onWww = host === 'www.croftcommontest.com';
             var onLogin = /^\/management\/login\/?$/.test(loc.pathname);
 
             if (hasRecoveryTokens) {
              // Single-hop: always send tokens directly to /management/login on www
              if (onApex || (onWww && !onLogin)) {
                var target = 'https://www.croftcommontest.com/management/login' + search + hash;
                console.info('[bootstrap] Directing tokens to /management/login on www');
                w.location.replace(target);
                return;
              }
            } else {
              // No tokens: canonicalise apex -> www preserving path
              if (onApex) {
                var newUrl = 'https://www.croftcommontest.com' + loc.pathname + search + hash;
                console.info('[bootstrap] Canonicalising to www');
                w.location.replace(newUrl);
                return;
              }
            }
          }
        } catch (e) { /* swallow to avoid blocking app */ }
      })();
    </script>
    <script id="early-error-catcher">
      (function(){
        try{
          var isNative = !!(window.Capacitor && typeof window.Capacitor.isNativePlatform==='function' && window.Capacitor.isNativePlatform());
          function showOverlay(text){
            try{
              var el=document.getElementById('early-error-overlay');
              if(!el){
                el=document.createElement('div');
                el.id='early-error-overlay';
                el.setAttribute('role','alert');
                el.style.position='fixed';
                el.style.inset='0';
                el.style.background='#0b0b0b';
                el.style.color='#ffffff';
                el.style.fontFamily='ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Noto Sans, sans-serif';
                el.style.fontSize='14px';
                el.style.lineHeight='1.4';
                el.style.padding='16px';
                el.style.zIndex='2147483647';
                el.style.overflow='auto';
                el.innerHTML='<h1 style="margin:0 0 8px 0;font-size:16px;">Start-up error</h1><pre id="early-error-pre" style="white-space:pre-wrap;word-break:break-word;margin:0;background:#111;padding:12px;border-radius:8px;border:1px solid #333;"></pre>';
                document.documentElement.appendChild(el);
              }
              var pre = document.getElementById('early-error-pre');
              if(pre){ pre.textContent = text; }
            }catch(e){}
          }
          function record(err){
            var payload = {
              time: new Date().toISOString(),
              userAgent: navigator.userAgent,
              url: location.href,
              message: String(err && err.message || err),
              stack: err && err.stack || null
            };
            try{ localStorage.setItem('cc_last_error', JSON.stringify(payload)); }catch(e){}
            if(isNative){ showOverlay('[native] ' + payload.message + (payload.stack? '\n' + payload.stack : '')); }
          }
          window.addEventListener('error', function(e){ if(e && e.error){ record(e.error); } else { record(e.message); } }, {once:false});
          window.addEventListener('unhandledrejection', function(e){ record(e && e.reason || 'unhandledrejection'); }, {once:false});
        }catch(e){}
      })();
    </script>
  </head>

  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
